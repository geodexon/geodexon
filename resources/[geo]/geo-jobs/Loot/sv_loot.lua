LootTable = {
    ['StoreRobbery'] = {
        {
            ['item'] = 'dollar',
            ['weight'] = 191,
            ['min'] = 1,
            ['max'] = 10
        },
        {
            ['item'] = nil,
            ['weight'] = 8,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'keycard_red',
            ['weight'] = 1,
            ['min'] = 1,
            ['max'] = 1
        },
    },

    ['WarehouseRobbery'] = {
        {
            ['item'] = 'forklift_keys',
            ['weight'] = 400,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'bottle',
            ['weight'] = 400,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'repair_kit',
            ['weight'] = 200,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'ammo_9mm',
            ['weight'] = 400,
            ['min'] = 1,
            ['max'] = 5
        },
        {
            ['item'] = 'lockpick',
            ['weight'] = 100,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'crowbar',
            ['weight'] = 400,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'propane_torch',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'burner_phone',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 1
        },
    },
    
    ['HouseRobbery'] = {
        {
            ['item'] = 'dollar',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 50
        },
        {
            ['item'] = 'weed_1g',
            ['weight'] = 10,
            ['min'] = 1,
            ['max'] = 2
        },
        {
            ['item'] = 'cigar',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 5
        },
        {
            ['item'] = 'pisswasser',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 5
        },
        {
            ['item'] = 'flashlight',
            ['weight'] = 10,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'pistol_mk2',
            ['weight'] = 2,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'ammo_9mm',
            ['weight'] = 5,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'lockpick_adv',
            ['weight'] = 5,
            ['min'] = 1,
            ['max'] = 1
        }
    },
    ['Vangelico'] = {
        {
            ['item'] = 'rolex',
            ['weight'] = 100,
            ['min'] = 1,
            ['max'] = 4
        },
        {
            ['item'] = 'goldchain',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 4
        },
        {
            ['item'] = '10kgoldchain',
            ['weight'] = 5,
            ['min'] = 1,
            ['max'] = 2
        },
        {
            ['item'] = 'diamond',
            ['weight'] = 2,
            ['min'] = 1,
            ['max'] = 2
        },
    },
    ['Garbage.1'] = {
        {
            ['item'] = 'redwood',
            ['weight'] = 100,
            ['min'] = 1,
            ['max'] = 2
        },
        {
            ['item'] = 'sandwich',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 4
        },
        {
            ['item'] = 'dollar',
            ['weight'] = 40,
            ['min'] = 1,
            ['max'] = 5
        },
        {
            ['item'] = 'bottle',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 1
        },
    },
    ['Garbage.2'] = {
        {
            ['item'] = 'redwood',
            ['weight'] = 100,
            ['min'] = 1,
            ['max'] = 2
        },
        {
            ['item'] = 'sandwich',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 4
        },
        {
            ['item'] = 'dollar',
            ['weight'] = 150,
            ['min'] = 5,
            ['max'] = 15
        },
        {
            ['item'] = 'knife',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'botle',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 1
        },
    },
    ['Garbage.3'] = {
        {
            ['item'] = 'dollar',
            ['weight'] = 150,
            ['min'] = 10,
            ['max'] = 25
        },
        {
            ['item'] = 'knife',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'weed_1g',
            ['weight'] = 50,
            ['min'] = 1,
            ['max'] = 1
        },
        {
            ['item'] = 'lockpick',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 1
        },
    },
    ['Garbage.4'] = {
        {
            ['item'] = 'weed_1g',
            ['weight'] = 50,
            ['min'] = 1,
            ['max'] = 2
        },
        {
            ['item'] = 'rolex',
            ['weight'] = 20,
            ['min'] = 1,
            ['max'] = 2
        },
        {
            ['item'] = 'pistol',
            ['weight'] = 1,
            ['min'] = 1,
            ['max'] = 1
        },
    },
    ['Garbage.5'] = {
        {
            ['item'] = 'weed_1g',
            ['weight'] = 50,
            ['min'] = 1,
            ['max'] = 3
        },
        {
            ['item'] = 'rolex',
            ['weight'] = 30,
            ['min'] = 1,
            ['max'] = 3
        },
        {
            ['item'] = 'pistol',
            ['weight'] = 5,
            ['min'] = 1,
            ['max'] = 1
        },
    },
    ['Garbage.6'] = {
        {
            ['item'] = 'weed_1g',
            ['weight'] = 50,
            ['min'] = 1,
            ['max'] = 3
        },
        {
            ['item'] = 'rolex',
            ['weight'] = 30,
            ['min'] = 1,
            ['max'] = 3
        },
        {
            ['item'] = 'pistol_mk2',
            ['weight'] = 5,
            ['min'] = 1,
            ['max'] = 1
        },
    }
}

function GetLoot(source, list)
    if not LootTable[list] then
        TriggerClientEvent('Shared.Notif', source, '[Error] Invalid Loot Table, plz fix')
        return
    end

    local ranges = {}
    local total = 0
    for k,v in pairs(LootTable[list]) do
        local min = total
        local max = total + v.weight
        total = total + v.weight
        table.insert(ranges, function(value)
            if value > min and value <= max then
                return {v.item, Random(v.min or 1, v.max or 1)}
            end
        end)
    end

    local rng = Random(total)
    for k,v in pairs(ranges) do
        local loot = v(rng)
        if loot then

            if not loot[1] then
                TriggerClientEvent('Shared.Notif', source, "You found nothing")
                return
            end

            if not exports['geo-inventory']:ReceiveItem('Player', source, table.unpack(loot)) then
                TriggerClientEvent('Shared.Notif', source, "You can't hold anything else")
                return false
            else
                return true
            end
        end
    end
end

function GetLootChance(list)
    if not LootTable[list] then
        TriggerClientEvent('Shared.Notif', source, '[Error] Invalid Loot Table, plz fix')
        return
    end

    local ranges = {}
    local total = 0
    for k,v in pairs(LootTable[list]) do
        total = total + v.weight
    end

    for k,v in pairs(LootTable[list]) do
        local chance = ((v.weight / total) * 100)
        Console('[Chance]', (v.item or 'none')..' '..round(chance, 2)..'%')
    end
end

exports('Loot', GetLoot)